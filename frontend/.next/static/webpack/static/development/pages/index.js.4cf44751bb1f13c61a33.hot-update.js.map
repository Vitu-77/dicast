{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.4cf44751bb1f13c61a33.hot-update.js","sources":["webpack:///./services/Api.js"],"sourcesContent":["import Cookies from 'js-cookie';\r\nimport Axios from 'axios';\r\nimport Router from 'next/router'\r\nimport jwt from 'jwt-simple';\r\n\r\nconst Fetch = Axios.create({ baseURL: 'http://localhost:3333' });\r\n\r\nexport default {\r\n    async isAuthenticated(setLoading, isLoginPage) {\r\n\r\n        const token = Cookies.get('DICAST_AUTH_TOKEN');\r\n\r\n        if (token === undefined || token === null || token === '') {\r\n            isLoginPage ? setLoading(false) : Router.push('/login');\r\n        }\r\n        else {\r\n            try {\r\n\r\n                const secretKey = '26sys323nosi188xzSXa98ZAA';\r\n                const decodedToken = jwt.decode(token, secretKey);\r\n\r\n                const response = await Axios.get('http://localhost:3333/is_authenticated', {\r\n                    headers: { decodedToken }\r\n                });\r\n\r\n                const { isAuthenticated } = response.data;\r\n\r\n                if (!isAuthenticated) {\r\n                    if (!isLoginPage) {\r\n                        Router.push('/login');\r\n                    }\r\n                    else {\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n                else {\r\n                    if (isLoginPage) {\r\n                        Router.push('/');\r\n                    }\r\n                    else {\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                Router.push('/login');\r\n            }\r\n        }\r\n    },\r\n\r\n    async authenticate(username, password, _setUser, setLoginError, persistLogged) {\r\n        const { data } = await Fetch.post('/authenticate', { username, password });\r\n\r\n        const { user, auth, error } = data;\r\n\r\n        const payload = { auth };\r\n        const secretKey = '26sys323nosi188xzSXa98ZAA';\r\n        const encodedToken = jwt.encode(payload, secretKey);\r\n\r\n        if (!error) {\r\n            await _setUser(user);\r\n\r\n            if (persistLogged) {\r\n                Cookies.set('DICAST_AUTH_TOKEN', encodedToken, { expires: 50000 });\r\n                Cookies.set('USERNAME', user.username, { expires: 50000 });\r\n                //TODO colocar o resto das infos nos cookies\r\n            }\r\n            else {\r\n                Cookies.set('DICAST_AUTH_TOKEN', encodedToken);\r\n                Cookies.set('USERNAME', user.username);\r\n                //TODO colocar o resto das infos nos cookies\r\n            }\r\n\r\n            // Router.push('/');\r\n        }\r\n        else {\r\n            switch (error) {\r\n                case 'user not found': setLoginError(1);\r\n                    break;\r\n                case 'invalid password': setLoginError(2);\r\n                    break;\r\n                default: setLoginError(1);\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    async getUser(userId, setUser) {\r\n        const { data } = await Fetch.get(`/users?user_id=${userId}`);\r\n\r\n        const { user } = data;\r\n\r\n        setUser(user);\r\n    }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AAKA;AANA;AAAA;AACA;AADA;AAAA;AAWA;AACA;AAZA;AAAA;AAeA;AAAA;AAAA;AADA;AACA;AAfA;AAcA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AApCA;AAAA;AACA;AADA;AAAA;AAAA;AAqCA;AACA;AAtCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AA0CA;AA1CA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AA2CA;AAAA;AAAA;AACA;AA5CA;AAAA;AA2CA;AAEA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAlDA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAsDA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAjEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAqEA;AArEA;AACA;AADA;AAuEA;AAvEA;AACA;AADA;AAyEA;AAzEA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AA+EA;AA/EA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAgFA;AAEA;AAEA;AACA;AArFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;;;;A","sourceRoot":""}
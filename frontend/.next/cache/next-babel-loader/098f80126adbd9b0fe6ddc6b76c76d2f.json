{"ast":null,"code":"import Cookies from 'js-cookie';\nimport Axios from 'axios';\nimport Router from 'next/router';\nimport jwt from 'jwt-simple';\nconst Fetch = Axios.create({\n  baseURL: 'http://localhost:3333'\n});\nexport default {\n  async isAuthenticated(setLoading, isLoginPage) {\n    const token = Cookies.get('DICAST_AUTH_TOKEN');\n\n    if (token === undefined || token === null || token === '') {\n      isLoginPage ? setLoading(false) : Router.push('/login');\n    } else {\n      try {\n        const SECRET = '26sys323nosi188xzSXa98ZAA';\n        const decodedToken = jwt.decode(token, SECRET, true);\n        console.log({\n          decodedToken\n        });\n        const response = await Axios.get('http://localhost:3333/is_authenticated', {\n          headers: {\n            decodedToken\n          }\n        });\n        const {\n          isAuthenticated\n        } = response.data;\n\n        if (!isAuthenticated) {\n          if (!isLoginPage) {\n            Router.push('/login');\n          } else {\n            setLoading(false);\n          }\n        } else {\n          if (isLoginPage) {\n            Router.push('/');\n          } else {\n            setLoading(false);\n          }\n        }\n      } catch (error) {\n        Router.push('/login');\n      }\n    }\n  },\n\n  async authenticate(username, password, _setUser, setLoginError, persistLogged) {\n    const {\n      data\n    } = await Fetch.post('/authenticate', {\n      username,\n      password\n    });\n    const {\n      user,\n      auth,\n      error\n    } = data;\n    const payload = {\n      token\n    };\n    console.log(payload);\n    const SECRET = '26sys323nosi188xzSXa98ZAA';\n    const token = jwt.encode(auth, SECRET);\n\n    if (!error) {\n      await _setUser(user);\n\n      if (persistLogged) {\n        Cookies.set('DICAST_AUTH_TOKEN', token, {\n          expires: 50000\n        });\n        Cookies.set('USERNAME', user.username, {\n          expires: 50000\n        }); //TODO colocar o resto das infos nos cookies\n      } else {\n        Cookies.set('DICAST_AUTH_TOKEN', token);\n        Cookies.set('USERNAME', user.username); //TODO colocar o resto das infos nos cookies\n      } // Router.push('/');\n\n    } else {\n      switch (error) {\n        case 'user not found':\n          setLoginError(1);\n          break;\n\n        case 'invalid password':\n          setLoginError(2);\n          break;\n\n        default:\n          setLoginError(1);\n          break;\n      }\n    }\n  },\n\n  async getUser(userId, setUser) {\n    const {\n      data\n    } = await Fetch.get(`/users?user_id=${userId}`);\n    const {\n      user\n    } = data;\n    setUser(user);\n  }\n\n};","map":{"version":3,"sources":["C:/Users/marce/Programação/Projetos/dicast/frontend/services/Api.js"],"names":["Cookies","Axios","Router","jwt","Fetch","create","baseURL","isAuthenticated","setLoading","isLoginPage","token","get","undefined","push","SECRET","decodedToken","decode","console","log","response","headers","data","error","authenticate","username","password","_setUser","setLoginError","persistLogged","post","user","auth","payload","encode","set","expires","getUser","userId","setUser"],"mappings":"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","sourcesContent":["import Cookies from 'js-cookie';\r\nimport Axios from 'axios';\r\nimport Router from 'next/router'\r\nimport jwt from 'jwt-simple';\r\n\r\nconst Fetch = Axios.create({ baseURL: 'http://localhost:3333' });\r\n\r\nexport default {\r\n    async isAuthenticated(setLoading, isLoginPage) {\r\n\r\n        const token = Cookies.get('DICAST_AUTH_TOKEN');\r\n\r\n        if (token === undefined || token === null || token === '') {\r\n            isLoginPage ? setLoading(false) : Router.push('/login');\r\n        }\r\n        else {\r\n            try {\r\n\r\n                const SECRET = '26sys323nosi188xzSXa98ZAA';\r\n                const decodedToken = jwt.decode(token, SECRET, true);\r\n\r\n                console.log({ decodedToken });\r\n\r\n                const response = await Axios.get('http://localhost:3333/is_authenticated', {\r\n                    headers: { decodedToken }\r\n                });\r\n\r\n                const { isAuthenticated } = response.data;\r\n\r\n                if (!isAuthenticated) {\r\n                    if (!isLoginPage) {\r\n                        Router.push('/login');\r\n                    }\r\n                    else {\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n                else {\r\n                    if (isLoginPage) {\r\n                        Router.push('/');\r\n                    }\r\n                    else {\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                Router.push('/login');\r\n            }\r\n        }\r\n    },\r\n\r\n    async authenticate(username, password, _setUser, setLoginError, persistLogged) {\r\n        const { data } = await Fetch.post('/authenticate', { username, password });\r\n\r\n        const { user, auth, error } = data;\r\n\r\n        const payload = { token };\r\n\r\n        console.log(payload);\r\n\r\n        const SECRET = '26sys323nosi188xzSXa98ZAA';\r\n        const token = jwt.encode(auth, SECRET);\r\n\r\n        if (!error) {\r\n            await _setUser(user);\r\n\r\n            if (persistLogged) {\r\n                Cookies.set('DICAST_AUTH_TOKEN', token, { expires: 50000 });\r\n                Cookies.set('USERNAME', user.username, { expires: 50000 });\r\n                //TODO colocar o resto das infos nos cookies\r\n            }\r\n            else {\r\n                Cookies.set('DICAST_AUTH_TOKEN', token);\r\n                Cookies.set('USERNAME', user.username);\r\n                //TODO colocar o resto das infos nos cookies\r\n            }\r\n\r\n            // Router.push('/');\r\n        }\r\n        else {\r\n            switch (error) {\r\n                case 'user not found': setLoginError(1);\r\n                    break;\r\n                case 'invalid password': setLoginError(2);\r\n                    break;\r\n                default: setLoginError(1);\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    async getUser(userId, setUser) {\r\n        const { data } = await Fetch.get(`/users?user_id=${userId}`);\r\n\r\n        const { user } = data;\r\n\r\n        setUser(user);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}